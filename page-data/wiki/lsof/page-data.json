{"componentChunkName":"component---src-templates-wiki-js","path":"/wiki/lsof/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"summary\">Summary</h1>\n<p>The command ‘lsof’ is used and short for list open files.</p>\n<h1 id=\"usage-examples\">Usage Examples</h1>\n<h2 id=\"list-all-network-connections\">List all network connections</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -i</code></pre></div>\n<h2 id=\"list-all-processes-listening-on-a-particular-port\">List all processes listening on a particular port</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -i :80\nCOMMAND   PID   USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME\nhttpd   37813   root    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37826 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37827 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37828 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37829 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37830 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37831 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37832 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)\nhttpd   37833 apache    4u  IPv4 3609901      0t0  TCP *:http (LISTEN)</code></pre></div>\n<h2 id=\"list-all-tcp-or-udp-connections\">List all TCP or UDP connections</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"> # lsof -i tcp\n # lsof -i udp</code></pre></div>\n<h2 id=\"list-all-ipv4-or-ipv6-network-files\">List all IPv4 or IPv6 network files</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -i 4\n# lsof -i 6</code></pre></div>\n<h2 id=\"list-all-network-files-using-tcp-port-ranges-from-1-1024\">List all network files using TCP port ranges from 1-1024</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -i TCP:1-1024</code></pre></div>\n<h2 id=\"list-all-network-files-in-use-by-a-specific-process\">List all network files in use by a specific process</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -i  -a -p &lt;pid&gt;</code></pre></div>\n<h2 id=\"list-active-connections\">List active connections</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -LnPTqs\n# lsof -LnPTqs | grep -i 10.100</code></pre></div>\n<h2 id=\"list-reads-and-writes-of-a-directory\">List reads and writes of a directory</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof &lt;path&gt; | grep -e &quot;[[:digit:]]\\+r\\|[[:digit:]]\\+w&quot;</code></pre></div>\n<h2 id=\"list-nfs-files\">List NFS files</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># lsof -N</code></pre></div>\n<h1 id=\"sysctl-help\">Sysctl Help</h1>\n<h2 id=\"list-count-of-file-descriptors-in-kernel-memory\">List count of file descriptors in kernel memory</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># sysctl fs.file-nr\nfs.file-nr = 26360\t0\t16401474</code></pre></div>\n<h1 id=\"scenario-based-examples\">Scenario Based Examples</h1>\n<h2 id=\"process-holding-open-deleted-files\">Process holding open (deleted) files</h2>\n<p>A process may be unable to write to a given directory and may state there is no space left on the\ndevice, but the ouput of <a href=\"/wiki/df/\"><code class=\"language-text\">df</code></a> shows there is plenty of space left. In this scenario,\nit may be likely that the process is holding a lock on file(s) that have been ‘deleted’, and <code class=\"language-text\">lsof</code>\ncan help determine if that is the case.</p>\n<p>Reviewing the output of the lsof command, take note of lines with ‘(deleted)’ in them. The ‘(deleted)’\nstring means the file has been deleted, but it could not be removed because it is locked by a running\nprocess. To resolve this issue, the process holding the files opened would need to be stopped to\nrelease the file locks, freeing up disk space.</p>\n<p><strong>BONUS</strong>\nIf in a bind and the process cannot be stopped, it is possible to track down file descriptor(s)\nin <code class=\"language-text\">/proc/&lt;pid&gt;/fd/</code> and zero the ‘deleted’ file. That process may look something like the below:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># &gt; /proc/&lt;pid&gt;/fd/4</code></pre></div>\n<p><em>Referenced commands:</em> <a href=\"/wiki/df\"><code class=\"language-text\">df</code></a></p>","tableOfContents":"<ul>\n<li><a href=\"/wiki/lsof/#summary\">Summary</a></li>\n<li>\n<p><a href=\"/wiki/lsof/#usage-examples\">Usage Examples</a></p>\n<ul>\n<li><a href=\"/wiki/lsof/#list-all-network-connections\">List all network connections</a></li>\n<li><a href=\"/wiki/lsof/#list-all-processes-listening-on-a-particular-port\">List all processes listening on a particular port</a></li>\n<li><a href=\"/wiki/lsof/#list-all-tcp-or-udp-connections\">List all TCP or UDP connections</a></li>\n<li><a href=\"/wiki/lsof/#list-all-ipv4-or-ipv6-network-files\">List all IPv4 or IPv6 network files</a></li>\n<li><a href=\"/wiki/lsof/#list-all-network-files-using-tcp-port-ranges-from-1-1024\">List all network files using TCP port ranges from 1-1024</a></li>\n<li><a href=\"/wiki/lsof/#list-all-network-files-in-use-by-a-specific-process\">List all network files in use by a specific process</a></li>\n<li><a href=\"/wiki/lsof/#list-active-connections\">List active connections</a></li>\n<li><a href=\"/wiki/lsof/#list-reads-and-writes-of-a-directory\">List reads and writes of a directory</a></li>\n<li><a href=\"/wiki/lsof/#list-nfs-files\">List NFS files</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/wiki/lsof/#sysctl-help\">Sysctl Help</a></p>\n<ul>\n<li><a href=\"/wiki/lsof/#list-count-of-file-descriptors-in-kernel-memory\">List count of file descriptors in kernel memory</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/wiki/lsof/#scenario-based-examples\">Scenario Based Examples</a></p>\n<ul>\n<li><a href=\"/wiki/lsof/#process-holding-open-deleted-files\">Process holding open (deleted) files</a></li>\n</ul>\n</li>\n</ul>","timeToRead":2,"fields":{"slug":"/wiki/lsof/"},"frontmatter":{"author":"mhassel","categories":["linux"],"created":"2018-02-02","description":null,"feature":false,"image":null,"show":true,"tags":["command line","linux"],"title":"lsof","updated":null},"parent":{"__typename":"File","sourceInstanceName":"wiki"}}},"pageContext":{"slug":"/wiki/lsof/"}},"staticQueryHashes":["1245490772","1673447228","1673447228","2742190585","3424645583","3813927108","3813927108","4171525417"]}